<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Th·ªëng K√™ Doanh Thu</title>
    <th:block th:replace="base::styles"></th:block>

    <!-- Th√™m th∆∞ vi·ªán Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div th:replace="base::header"></div>
    <div class="container">
        <h2 class="text-center text-info mt-1">TH·ªêNG K√ä DOANH THU</h2>

        <!-- Form ch·ªçn th·ªùi gian -->
        <form th:action="@{/stats/revenue}" method="post">
            <label for="time">Ch·ªçn lo·∫°i th·ªùi gian:</label>
            <select id="time" name="time">
                <option value="MONTH" th:selected="${selectedTime == 'MONTH'}">Th√°ng</option>
                <option value="WEEK" th:selected="${selectedTime == 'WEEK'}">Tu·∫ßn</option>
                <option value="DAY" th:selected="${selectedTime == 'DAY'}">Ng√†y</option>
            </select>

            <label for="year">Ch·ªçn nƒÉm:</label>
            <input type="number" id="year" name="year" th:value="${selectedYear}" required />

            <button type="submit" class="btn btn-primary">Xem th·ªëng k√™</button>
        </form>

        <!-- Hi·ªÉn th·ªã d·ªØ li·ªáu -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>S·ªë l∆∞·ª£ng Job</th>
                    <th>Candidate</th>
                    <th>Employer</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="row : ${stats}">
                    <td th:text="${row[0]}"></td>
                    <td th:text="${row[1]}"></td>
                    <td th:text="${row[2]}"></td>
                    <td th:text="${row[3]}"></td>
                </tr>
            </tbody>
        </table>

        <!-- Bi·ªÉu ƒë·ªì -->
        <canvas id="revenueChart"></canvas>

        <script th:inline="javascript">
            let data = /*[[${stats}]]*/ [];

            console.log("D·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω:", data); // üîé Ki·ªÉm tra tr√™n Console

            if (data.length > 0) {
                let labels = data.map(row => row.time); // Th·ªùi gian
                let jobCounts = data.map(row => row.jobCount); // S·ªë l∆∞·ª£ng Job
                let candidateCounts = data.map(row => row.candidateCount); // S·ªë l∆∞·ª£ng Candidate
                let employerCounts = data.map(row => row.employerCount); // S·ªë l∆∞·ª£ng Employer

                let ctx = document.getElementById("revenueChart").getContext("2d");
                new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [
                            {label: "S·ªë l∆∞·ª£ng Job", data: jobCounts, backgroundColor: "blue"},
                            {label: "Candidate", data: candidateCounts, backgroundColor: "green"},
                            {label: "Employer", data: employerCounts, backgroundColor: "orange"}
                        ]
                    },
                    options: {responsive: true, scales: {y: {beginAtZero: true}}}
                });
            } else {
                document.getElementById("revenueChart").style.display = "none"; // ·∫®n n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
            }
        </script>



</body>
</html>
